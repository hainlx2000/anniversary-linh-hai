<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>❤️</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fff5f7 0%, #ffe0e8 50%, #ffc9d6 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        .image-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            cursor: pointer;
            transition: all 0.3s ease;
            max-width: 90%;
            max-height: 90vh;
        }

        .image-container img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(255, 105, 180, 0.5);
            transition: transform 0.3s ease;
        }

        .image-container:hover img {
            transform: scale(1.05);
        }

        .image-container.with-content {
            position: fixed;
            top: 20%;
            left: auto;
            right: 50px;
            transform: none;
            max-width: 300px;
        }

        .image-container.with-content img {
            max-height: 400px;
        }

        @media (max-width: 768px) {
            body.with-key {
                flex-direction: column;
                padding: 20px;
                align-items: center;
                justify-content: flex-start;
            }

            .image-container.with-content {
                position: relative;
                top: auto;
                left: auto;
                right: auto;
                transform: none;
                max-width: 200px;
                margin-bottom: 20px;
                margin-top: 0;
            }

            .image-container.with-content img {
                max-height: 250px;
            }
        }

        .heart-container {
            display: none;
        }

        .heart {
            width: 100px;
            height: 100px;
            position: relative;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        .heart::before,
        .heart::after {
            content: "";
            width: 50px;
            height: 80px;
            position: absolute;
            background: linear-gradient(135deg, #ff6b9d 0%, #ff85a3 100%);
            border-radius: 50px 50px 0 0;
            opacity: 0.8;
            top: 0;
        }

        .heart::before {
            left: 50px;
            transform: rotate(-45deg);
            transform-origin: 0 100%;
        }

        .heart::after {
            left: 0;
            transform: rotate(45deg);
            transform-origin: 100% 100%;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            10%, 30% { transform: scale(1.1); }
            20%, 40% { transform: scale(0.95); }
        }

        .schedule-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(255, 105, 180, 0.3);
            max-width: 600px;
            width: 100%;
            position: relative;
            z-index: 2;
            display: none;
        }

        .schedule-container.visible {
            display: block;
        }

        h1 {
            color: #ff69b4;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(255, 105, 180, 0.2);
        }

        .schedule-item {
            background: linear-gradient(135deg, #fff0f5 0%, #ffe4ed 100%);
            padding: 20px;
            margin: 15px 0;
            border-radius: 15px;
            border-left: 5px solid #ff69b4;
            transition: transform 0.3s ease;
        }

        .schedule-item:hover {
            transform: translateX(10px);
        }

        .time {
            color: #ff1493;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .activity {
            color: #666;
            font-size: 1.1em;
        }

        .countdown-container {
            background: linear-gradient(135deg, #ff69b4 0%, #ff85a3 100%);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 30px rgba(255, 105, 180, 0.4);
            display: none;
        }

        .countdown-container.visible {
            display: block;
        }

        .countdown-title {
            text-align: center;
            color: white;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 25px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .countdown-timer {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .time-unit {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            min-width: 80px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .time-unit:hover {
            transform: translateY(-5px);
        }

        .time-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #ff1493;
            line-height: 1;
            font-family: 'Courier New', monospace;
        }

        .time-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 8px;
            text-transform: uppercase;
        }

        .time-separator {
            font-size: 2.5em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .target-date {
            text-align: center;
            color: white;
            font-size: 1.1em;
            margin-top: 20px;
            font-weight: 500;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .time-unit {
                min-width: 60px;
                padding: 15px 10px;
            }

            .time-value {
                font-size: 1.8em;
            }

            .time-separator {
                font-size: 1.8em;
            }

            .countdown-title {
                font-size: 1.2em;
            }

            .target-date {
                font-size: 0.9em;
            }
        }

        /* Book styles */
        .book-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .book-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .book {
            width: 800px;
            height: 900px;
            background: #f9f4ed;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
            padding: 60px 50px;
            animation: bookOpen 0.6s ease;
            overflow: hidden;
        }

        @keyframes bookOpen {
            from {
                transform: scale(0.5) rotateY(-90deg);
                opacity: 0;
            }
            to {
                transform: scale(1) rotateY(0);
                opacity: 1;
            }
        }

        .book-page {
            display: none;
            height: calc(100% - 80px);
            overflow-y: auto;
            line-height: 1.8;
            color: #333;
            font-size: 1.1em;
            padding-bottom: 20px;
        }

        .book-page.active {
            display: block;
            animation: pageFlip 0.4s ease;
        }

        @keyframes pageFlip {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .page-number {
            position: absolute;
            bottom: 20px;
            right: 50px;
            color: #999;
            font-style: italic;
        }

        .book-navigation {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }

        .nav-btn {
            background: linear-gradient(135deg, #ff69b4, #ff85a3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 105, 180, 0.4);
        }

        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .close-book {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ff69b4;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5em;
            transition: all 0.3s ease;
        }

        .close-book:hover {
            background: #ff1493;
            transform: rotate(90deg);
        }

        .book-content {
            text-align: justify;
            margin-bottom: 20px;
        }

        .book-content p {
            margin-bottom: 15px;
        }

        h2 {
            color: #ff69b4;
            margin-bottom: 20px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .book {
                width: 90%;
                height: 80vh;
                padding: 40px 30px 100px 30px;
            }

            .book-page {
                height: calc(100% - 100px);
                padding-bottom: 30px;
            }

            .book-navigation {
                bottom: 15px;
                gap: 10px;
            }

            .nav-btn {
                padding: 10px 18px;
                font-size: 0.9em;
            }

            h1 {
                font-size: 1.8em;
            }

            .schedule-container {
                padding: 20px;
            }
        }

        /* Anniversary Cake Styles - Full Screen Modal */
        .anniversary-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2d1b3d 0%, #4a2d5e 50%, #2d1b3d 100%);
            display: none;
            z-index: 9999;
            animation: fadeIn 0.5s ease;
            overflow: hidden;
        }

        .anniversary-overlay.active {
            display: flex;
        }

        /* Inner wrapper to center everything properly */
        .anniversary-wrapper {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .anniversary-content {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .anniversary-title {
            color: #ffd700;
            font-size: 3.5em;
            margin-bottom: 40px;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 60px rgba(255, 215, 0, 0.4);
            animation: pulse 1.5s ease-in-out infinite;
            font-weight: bold;
            position: relative;
            z-index: 100;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Birthday cake container - mimics original cake.html body style */
        .cake-modal-container {
            position: relative;
            width: 100%;
            height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #birthday-cake {
            position: relative;
            top: 50px;
            left: 0;
        }

        #birthday-cake:before {
            content: "";
            position: absolute;
            background-color: #ede0d4;
            width: 400px;
            height: 140px;
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -10%);
            box-shadow: inset -2px -5px #e6ccb2;
        }

        .cake {
            position: absolute;
            background-color: #ddb892;
            width: 350px;
            height: 130px;
            left: 50%;
            transform: translate(-50%, -60%);
        }

        .cake:before, .cake:after {
            content: "";
            position: absolute;
        }

        .cake:before, .middle, .middle:before {
            border-radius: 50% 50% 50% 50% / 0% 0% 100% 100%;
            width: 350px;
            height: 50px;
        }

        .cake:before {
            background-color: #ddb892;
            top: 130px;
        }

        .cake:after {
            background-color: #b08968;
            width: 350px;
            height: 30px;
            top: 50px;
        }

        .middle {
            position: absolute;
            background-color: #b08968;
            top: 80px;
            z-index: 1;
        }

        .middle:before {
            content: "";
            position: absolute;
            background-color: #ddb892;
            top: -35px;
        }

        .top {
            position: absolute;
            background-color: #7f5539;
            width: 350px;
            height: 90px;
            border-radius: 50%;
            z-index: 2;
            top: -45px;
            box-shadow: inset -5px -1px #fff, inset -70px 2px rgba(255, 255, 255, 0.1);
        }

        .chocs {
            position: absolute;
            width: 55px;
            height: 50px;
            background-color: #7f5539;
            top: 0;
            left: 0;
            z-index: 1;
            border-radius: 50% 50% 50% 50% / 0% 0% 100% 100%;
            box-shadow: 49px 20px #7f5539, 98px 25px #7f5539, 147px 30px #7f5539, 196px 25px #7f5539, 245px 20px #7f5539, 295px 0 #7f5539, 0px 4px #fff, 49px 24px #fff, 98px 29px #fff, 147px 34px #fff, 196px 29px #fff, 245px 24px #fff, 295px 4px #fff;
        }

        .chocs:before {
            content: "";
            position: absolute;
            width: 175px;
            height: 180px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 100% 0% 100% 0% / 0% 72% 28% 100%;
            left: 175px;
            top: 0;
        }

        .candles {
            position: absolute;
            width: 30px;
            height: 80px;
            background-color: #ff69b4;
            top: -160px;
            left: 50%;
            margin-left: -20px;
            z-index: 3;
            box-shadow: 50px 20px #ff69b4, -50px 20px #ff69b4;
            cursor: pointer;
        }

        .candles:before {
            content: "";
            position: absolute;
            width: 30px;
            height: 10px;
            background-color: #ff69b4;
            border-radius: 50%;
            top: -5px;
            box-shadow: 0 80px #ff69b4, -50px 20px #ff69b4, -50px 100px #ff69b4, 50px 20px #ff69b4, 50px 100px #ff69b4, inset 2px -1px #fff;
        }

        .candles:after {
            content: "";
            position: absolute;
            width: 30px;
            height: 10px;
            border-radius: 50%;
            top: 15px;
            left: 50px;
            box-shadow: inset 2px -1px #fff;
        }

        .shadows {
            position: absolute;
            width: 30px;
            height: 10px;
            border-radius: 50%;
            box-shadow: inset 2px -1px #fff;
            left: -50px;
            top: 15px;
        }

        .shadows:before {
            content: "";
            position: absolute;
            background-color: #333;
            width: 1.5px;
            height: 15px;
            left: 14.5px;
            top: -10px;
            box-shadow: 50px -20px #333, 100px 0 #333;
        }

        .shadows:after {
            content: "";
            position: absolute;
            width: 15px;
            height: 90px;
            left: 15px;
            background-color: rgba(255, 255, 255, 0.1);
            box-shadow: 50px -20px rgba(255, 255, 255, 0.1), 100px 0 rgba(255, 255, 255, 0.1);
            border-radius: 0% 100% 50% 50% / 100% 6% 10% 0%;
        }

        .flame, .flame:before, .flame2, .flame2:before, .flame3, .flame3:before {
            position: absolute;
            border-radius: 80% 15% 55% 50% / 55% 15% 80% 50%;
        }

        .flame, .flame3, .flame2 {
            cursor: pointer;
            width: 30px;
            height: 30px;
            transform: rotate(-45deg);
            z-index: 4;
            background-color: rgba(252, 191, 73, 0.8);
            transition: 0.5s;
            animation: flameAnim 0.5s infinite;
        }

        .flame {
            top: -40px;
        }

        .flame2, .flame3 {
            top: -20px;
        }

        .flame2 {
            left: -50px;
        }

        .flame3 {
            left: 50px;
        }

        .flame:before, .flame2:before, .flame3:before {
            content: "";
            background-color: rgba(247, 127, 0, 0.4);
            width: 20px;
            height: 20px;
            top: 5px;
            left: 5px;
        }

        @keyframes flameAnim {
            0%, 25%, 100% { transform: scaleY(1) rotate(-45deg); }
            50%, 75% { transform: scaleY(1.1) rotate(-45deg); }
        }

        .anniversary-text {
            position: absolute;
            color: white;
            font-family: 'Brush Script MT', cursive;
            text-align: center;
            width: 500px;
            font-size: 45px;
            left: 50%;
            margin-left: -250px;
            top: 120px;
            z-index: 5;
            transition: 0.5s;
            opacity: 0;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8);
            line-height: 1.3;
            word-wrap: break-word;
        }

        .anniversary-text.show {
            top: -180px;
            opacity: 1;
        }

        .flame.blown, .flame2.blown, .flame3.blown {
            opacity: 0;
        }

        .close-anniversary {
            position: fixed;
            top: 30px;
            right: 30px;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 2em;
            transition: all 0.3s ease;
            z-index: 10000;
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.5);
            font-weight: bold;
        }

        .close-anniversary:hover {
            background: linear-gradient(135deg, #ff1493, #ff69b4);
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 105, 180, 0.8);
        }

        @media (max-width: 768px) {
            .anniversary-title {
                font-size: 2em;
                margin-bottom: 20px;
            }

            .cake-modal-container {
                height: 400px;
            }

            #birthday-cake {
                transform: scale(0.65);
            }

            .close-anniversary {
                width: 50px;
                height: 50px;
                top: 20px;
                right: 20px;
                font-size: 1.5em;
            }

            .anniversary-text {
                font-size: 40px !important;
                width: 440px !important;
                margin-left: -175px !important;
                line-height: 1.2 !important;
            }

            .anniversary-text.show {
                top: -200px !important;
            }
        }
    </style>
</head>
<body>
    <div class="image-container">
        <img src="anh_w_khanh_linh.png" alt="Kỷ niệm" id="mainImage">
    </div>

    <div class="schedule-container">
        <h1>❤️</h1>
        
        <div class="countdown-container">
            <div class="countdown-title">Chúng ta đã bên nhau được</div>
            <div class="countdown-timer">
                <div class="time-unit">
                    <div class="time-value" id="days">00</div>
                    <div class="time-label">Ngày</div>
                </div>
                <div class="time-separator">:</div>
                <div class="time-unit">
                    <div class="time-value" id="hours">00</div>
                    <div class="time-label">Giờ</div>
                </div>
                <div class="time-separator">:</div>
                <div class="time-unit">
                    <div class="time-value" id="minutes">00</div>
                    <div class="time-label">Phút</div>
                </div>
                <div class="time-separator">:</div>
                <div class="time-unit">
                    <div class="time-value" id="seconds">00</div>
                    <div class="time-label">Giây</div>
                </div>
            </div>
            <div class="target-date">📅 Kỷ niệm từ 22:22:22 18/10/2025 ❤️</div>
        </div>
    </div>

    <div class="heart-container" id="heart">
        <div class="heart"></div>
    </div>

    <div class="anniversary-overlay" id="anniversaryOverlay">
        <button class="close-anniversary" id="closeAnniversary">×</button>
        <div class="anniversary-wrapper">
            <div class="anniversary-content">
                <div class="cake-modal-container">
                    <div id="birthday-cake">
                        <div class="cake">
                            <div class="middle"></div>
                            <div class="chocs"></div>
                            <div class="top"></div>
                        </div>
                        <div class="candles" id="cakeCandles">
                            <div class="flame" id="cakeFlame1"></div>
                            <div class="flame2" id="cakeFlame2"></div>
                            <div class="flame3" id="cakeFlame3"></div>
                            <div class="anniversary-text" id="anniversaryText">Chúc mừng 1 Tuần bên nhau!</div>
                            <div class="shadows"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <audio id="anniversaryAudio" preload="auto">
        <source src="Photograph.mp3" type="audio/mp3">
    </audio>

    <div class="book-overlay" id="bookOverlay">
        <div class="book">
            <button class="close-book" id="closeBook">×</button>
            
            <div class="book-page active" data-page="1">
                <h2>💌 Gửi Linh</h2>
                <div class="book-content">
                    <p>Anh biết em thích thư tay, nhưng với những lời sau thì anh muốn nó được hiển thị một cách xinh xắn nhất nên anh chọn cách thể hiện như này. </p>
                    <p> Trước khi viết những lời này, anh đã ngồi nghĩ làm sao để viết cho hay, nhưng mà anh nghĩ mãi cũng chả biết viết sao cho hay, nên là em đọc nhé.
                        Mong rằng em sẽ thích 💝</p>
                </div>
            </div>

            <div class="book-page" data-page="2">
                <h2>💌 </h2>
                <div class="book-content">
                    <p>こんにちは、 Khánh Linh. Em còn nhớ câu đầu tiên anh nhắn em là gì không?</p>
                    <p>Không biết em có nhớ không, còn lúc anh đang viết dòng này thì anh không nhớ rõ ràng nó là gì đâu, anh chỉ còn nhớ là khen em xinhhh, chắc xíu viết xong anh phải mở tiktok lên xem lại thôi.</p>
                    <p>Sau hôm đi chơi thứ hai, anh biết em có suy nghĩ về câu "Anh không thể nói trước điều gì".</p>
                    <p>Có lẽ anh làm em hiểu nhầm là tình cảm của anh nay đến, mai đi.</p>
                    <p>Nhưng không phải, điều mà anh không thể biết là nhờ câu mở đầu đó thì hôm nay sắp tới buổi thứ 3 được đón em đi chơi rồi (Nếu em đọc được lá thư này thì là buổi thứ 3 rồi nhớ). Anh không thể biết!</p>
                    <p>Từ khi gặp em, cuộc sống anh cảm giác nó nhẹ nhàng hơn, chậm rãi hơn. Đi xe chậm lại trước đèn tín hiệu để trả lời tin nhắn em, đi chơi cũng thích về sớm để nói chuyện hay chơi game với em và anh biết thì ngoài gia đình, hiện tại còn có một em bé đợi anh về.</p>
                    <p>Đây cũng là điều mà anh không thể biết khi anh reply em vào ngày hôm đó, rằng anh có tình cảm với em nhiều như thế này.</p>
                </div>
            </div>

            <div class="book-page" data-page="3">
                <h2>💌</h2>
                <div class="book-content">
                    <p>Có người nói: 'Cuộc đời có nhiều điều bất ngờ nhưng anh nghĩ là tất cả điều trên đời đều được sắp xếp. Và có lẽ anh đã dành nhiều sự may mắn của mình vào việc được ông trời sắp xếp để anh gặp được em - một em bé xinh, ngoan ngoãn, dịu dàng, nhẹ nhàng.</p>
                    <p>Ngoài những điều trên, anh có thể cảm nhận em là một người mạnh mẽ (qua lời kể của em) nhưng cũng nhạy cảm, biết suy nghĩ, lắng nghe.</p>
                    <p>Đó là những điều anh cảm nhận ban đầu, nhưng, anh muốn tìm hiểu nhiều hơn về em, muốn ngồi với em, lắng nghe từng câu chuyện của em, muốn biết em thích gì, ghét gì, điều gì làm em vui, điều gì làm em khó chịu, vân vân, càng nhiều điều về em anh thấy càng ít 😁.</p>
                </div>
            </div>

            <div class="book-page" data-page="4">
                <h2>💌</h2>
                <div class="book-content">
                    <p>Đến đây là tạm hết rùiiiiii. Em đọc tới đây thì bảo anh nhé!!!!!</p>
                    <p style="text-align: center; margin-top: 40px; font-size: 2em;">❤️</p>
                </div>
            </div>
            
            <div class="book-navigation">
                <button class="nav-btn" id="prevBtn" disabled>◀ Trang trước</button>
                <button class="nav-btn" id="nextBtn">Trang sau ▶</button>
            </div>
        </div>
    </div>

    <script>
        // Anniversary Timer - counting up from the date
        function updateCountdown() {
            const anniversaryDate = new Date('2025-10-18T22:22:22+07:00').getTime();
            const now = new Date().getTime();
            const distance = now - anniversaryDate;

            if (distance < 0) {
                document.getElementById('days').textContent = '00';
                document.getElementById('hours').textContent = '00';
                document.getElementById('minutes').textContent = '00';
                document.getElementById('seconds').textContent = '00';
                document.querySelector('.countdown-title').textContent = '⏳ Sắp đến ngày kỷ niệm rồi! ⏳';
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById('days').textContent = String(days).padStart(2, '0');
            document.getElementById('hours').textContent = String(hours).padStart(2, '0');
            document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
        }

        // Check if URL has key=khanhlinhxinh
        const urlParams = new URLSearchParams(window.location.search);
        const keyValue = urlParams.get('key');
        const hasKey = keyValue === 'khanhlinhxinh';

        const imageContainer = document.querySelector('.image-container');
        const mainImage = document.getElementById('mainImage');
        const scheduleContainer = document.querySelector('.schedule-container');
        const countdownContainer = document.querySelector('.countdown-container');

        // Show schedule and countdown only if key is present
        if (hasKey) {
            document.body.classList.add('with-key');
            scheduleContainer.classList.add('visible');
            countdownContainer.classList.add('visible');
            imageContainer.classList.add('with-content');
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        const bookOverlay = document.getElementById('bookOverlay');
        const closeBook = document.getElementById('closeBook');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const pages = document.querySelectorAll('.book-page');

        var currentPage = 1;
        const totalPages = 4;

        // Click on image to open book
        mainImage.addEventListener('click', function() {
            if (hasKey) {
                bookOverlay.classList.add('active');
            } else {
                alert('💕💕💕💕💕');
            }
        });

        closeBook.addEventListener('click', function() {
            bookOverlay.classList.remove('active');
        });

        bookOverlay.addEventListener('click', function(e) {
            if (e.target === bookOverlay) {
                bookOverlay.classList.remove('active');
            }
        });

        function updatePage() {
            pages.forEach(page => page.classList.remove('active'));
            pages[currentPage - 1].classList.add('active');

            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
        }

        prevBtn.addEventListener('click', function() {
            if (currentPage > 1) {
                currentPage--;
                updatePage();
            }
        });

        nextBtn.addEventListener('click', function() {
            if (currentPage < totalPages) {
                currentPage++;
                updatePage();
            }
        });

        // ===== ANNIVERSARY MILESTONE SYSTEM =====
        
        // TEST MODE: Set this to true to use test time, false for real time
        const TEST_MODE = false;
        
        // FORCE SHOW: Set to true to show cake immediately (bypasses all checks)
        // Useful for quick testing without changing dates
        const FORCE_SHOW_NOW = false;
        
        // TEST TIME: Change this to test different milestones (in milliseconds from anniversary date)
        // Examples:
        const TEST_TIME_OFFSET = 7 * 24 * 60 * 60 * 1000; // Default: 1 week
        
        // PRODUCTION: Set the actual anniversary date/time
        const ANNIVERSARY_DATE = '2025-10-18T22:22:22+07:00';
        
        // Anniversary milestones in milliseconds
        const MILESTONES = [
            // 6 ngày + 14 giờ + 44 phút
            { time: 7 * 24 * 60 * 60 * 1000 + 20 * 60 * 60 * 1000 + 50 * 60 * 100, name: '一週間' },
            { time: 14 * 24 * 60 * 60 * 1000, name: '二週間' },          // 2 weeks
            { time: 21 * 24 * 60 * 60 * 1000, name: '三週間' },          // 3 weeks
            { time: 30 * 24 * 60 * 60 * 1000, name: '一ヶ月' },         // 1 month
            { time: 7 * 5 * 24 * 60 * 60 * 1000, name: '五週間' },      // 5 weeks
            { time: 7 * 6 * 24 * 60 * 60 * 1000, name: '六週間' },      // 6 weeks
            { time: 7 * 7 * 24 * 60 * 60 * 1000, name: '七週間' },      // 7 weeks
            { time: 60 * 24 * 60 * 60 * 1000, name: '二ヶ月' },         // 2 months
            { time: 7 * 9 * 24 * 60 * 60 * 1000, name: '九週間' },      // 9 weeks
            { time: 7 * 10 * 24 * 60 * 60 * 1000, name: '十週間' },      // 10 weeks
            { time: 90 * 24 * 60 * 60 * 1000, name: '三ヶ月' },         // 3 months
            { time: 180 * 24 * 60 * 60 * 1000, name: '六ヶ月' },        // 6 months
            { time: 365 * 24 * 60 * 60 * 1000, name: '一年' }           // 1 year
        ];
        
        const anniversaryOverlay = document.getElementById('anniversaryOverlay');
        const closeAnniversaryBtn = document.getElementById('closeAnniversary');
        const anniversaryText = document.getElementById('anniversaryText');
        const cakeCandles = document.getElementById('cakeCandles');
        const cakeFlame1 = document.getElementById('cakeFlame1');
        const cakeFlame2 = document.getElementById('cakeFlame2');
        const cakeFlame3 = document.getElementById('cakeFlame3');
        const anniversaryAudio = document.getElementById('anniversaryAudio');
        
        let lastCheckedMilestone = localStorage.getItem('lastAnniversaryMilestone') || null;
        
        // Track the next milestone to check
        let nextMilestoneIndex = 0;
        
        // Function to find next uncelebrated milestone
        function findNextMilestone(timeSinceAnniversary) {
            for (let i = 0; i < MILESTONES.length; i++) {
                const milestone = MILESTONES[i];
                const milestoneName = `${milestone.name}_${milestone.time}`;
                
                // Skip already celebrated milestones
                if (lastCheckedMilestone === milestoneName) {
                    continue;
                }
                
                // Return the first uncelebrated milestone that we haven't passed yet
                // or that we're currently within tolerance of
                if (timeSinceAnniversary <= milestone.time + 1000) {
                    return i;
                }
            }
            return -1; // No more milestones
        }
        
        function checkAnniversary() {
            if (!hasKey) return; // Only check if user has access
            
            // FORCE SHOW mode - bypass all checks and show immediately
            if (FORCE_SHOW_NOW) {
                const milestoneName = 'テスト30秒'; // Default for force show
                showAnniversaryCelebration(milestoneName);
                return;
            }
            
            // Calculate time since anniversary
            const anniversaryDate = new Date(ANNIVERSARY_DATE).getTime();
            const now = new Date().getTime();
            const timeSinceAnniversary = TEST_MODE ? 
                TEST_TIME_OFFSET :  // Use offset for testing
                (now - anniversaryDate); // Use real time difference for production
            
            if (timeSinceAnniversary < 0) return; // Haven't reached anniversary yet
            
            // Find the next milestone if we don't have one
            if (nextMilestoneIndex === null || nextMilestoneIndex < 0) {
                nextMilestoneIndex = findNextMilestone(timeSinceAnniversary);
                if (nextMilestoneIndex < 0) {
                    console.log('✓ All milestones celebrated!');
                    return; // No more milestones
                }
            }
            
            // Check only the next milestone
            if (nextMilestoneIndex >= 0 && nextMilestoneIndex < MILESTONES.length) {
                const milestone = MILESTONES[nextMilestoneIndex];
                const tolerance = 1000;
                const milestoneName = `${milestone.name}_${milestone.time}`;
                const timeDiff = Math.abs(timeSinceAnniversary - milestone.time);
                if (timeDiff <= tolerance) {
                    // We're within tolerance of this milestone!
                    if (lastCheckedMilestone !== milestoneName) {
                        showAnniversaryCelebration(milestone.name);
                        lastCheckedMilestone = milestoneName;
                        localStorage.setItem('lastAnniversaryMilestone', milestoneName);
                        
                        // Move to next milestone
                        nextMilestoneIndex = findNextMilestone(timeSinceAnniversary);
                    }
                }
            }
        }
        
        function showAnniversaryCelebration(milestoneName) {
            anniversaryText.innerHTML = `${milestoneName} 一緒に過ごして、おめでとう！<br> これからもよろしくね！`;
            anniversaryOverlay.classList.add('active');
            
            // Play audio with better error handling
            anniversaryAudio.currentTime = 145;
            anniversaryAudio.volume = 1.0; // Ensure volume is at max
            
            const playPromise = anniversaryAudio.play();
            
            if (playPromise !== undefined) {
                playPromise
                    .then(() => {
                        console.log('✓ Audio is playing');
                    })
                    .catch(error => {
                        console.log('⚠ Audio autoplay blocked by browser. Click anywhere to start music.');
                        console.log(error)
                        // Fallback: play on user interaction
                        const playOnInteraction = () => {
                            anniversaryAudio.play()
                                .then(() => console.log('✓ Audio started after user interaction'))
                                .catch(e => console.log('✗ Audio failed:', e));
                            document.removeEventListener('click', playOnInteraction);
                            cakeCandles.removeEventListener('click', playOnInteraction);
                        };
                        document.addEventListener('click', playOnInteraction, { once: true });
                        cakeCandles.addEventListener('click', playOnInteraction, { once: true });
                    });
            }
            
            // No automatic candle blow - user must click candles to blow them
        }
        
        function blowCandles() {
            cakeFlame1.classList.add('blown');
            cakeFlame2.classList.add('blown');
            cakeFlame3.classList.add('blown');
            anniversaryText.classList.add('show');
        }
        
        function closeAnniversary() {
            anniversaryOverlay.classList.remove('active');
            anniversaryAudio.pause();
            anniversaryAudio.currentTime = 0;
            
            // Reset candles
            cakeFlame1.classList.remove('blown');
            cakeFlame2.classList.remove('blown');
            cakeFlame3.classList.remove('blown');
            anniversaryText.classList.remove('show');
        }
        
        // Event listeners
        closeAnniversaryBtn.addEventListener('click', closeAnniversary);
        cakeCandles.addEventListener('click', blowCandles);
        
        // Check for milestones
        if (hasKey) {
            if (TEST_MODE) {
                // In test mode, check immediately and every minute
                checkAnniversary();
                setInterval(checkAnniversary, 60000);
            } else {
                // In production/testing mode, check immediately and every 5 seconds for faster response
                checkAnniversary();
                setInterval(checkAnniversary, 1000); // Check every 5 seconds
            }
        }
        
        // ===== END ANNIVERSARY SYSTEM =====
    </script>
</body>
</html>
